app-id: one.alynx.FlipClock
runtime: org.freedesktop.Platform
runtime-version: "21.08"
sdk: org.freedesktop.Sdk
command: flipclock
modules:
  # The SDL_ttf in `shared-modules` repo is for SDL1,
  # and the SDK only contains SDL2 but has no SDL2_ttf,
  # so I will build and bundle SDL2_ttf by myself.
  - name: SDL2_ttf
    buildsystem: autotools
    rm-configure: true
    config-opts:
      - "--disable-static"
      # The SDK contains FreeType and HarfBuzz, so prevent from building them.
      - "--disable-freetype-builtin"
      - "--disable-harfbuzz-builtin"
    cleanup:
      # Those files are for developing, not for running.
      - "/include"
      - "/lib/pkgconfig"
      - "/lib/*.la"
      - "/lib/*.a"
    sources:
      - type: archive
        # Yes, SDL2_ttf is actually in the `SDL_ttf` repo.
        url: https://github.com/libsdl-org/SDL_ttf/archive/release-2.0.18.tar.gz
        sha512: 4baa0917e5a3b7daf046eb624369202dbc4be5db6197807bb0228252e290fd62d9daa2063f177296479e654035804b72afd992a556b4299a01657710c8d7ec2a
  - name: flipclock
    buildsystem: meson
    sources:
      - type: archive
        url: https://github.com/AlynxZhou/flipclock/archive/v2.8.7.tar.gz
        sha512: b9f91a1a32ce4dc54a5a3197328c6486c5b54e4fcda61aa5d1578749bcd4bfb9cc80dc9fb146dda8b631750d4740384e3d26ee44f83ac5c3a53deaf33f0b6dbf
finish-args:
  # See <https://docs.flatpak.org/en/latest/sandbox-permissions.html#standard-permissions>.
  # OpenGL rendering.
  - "--device=dri"
  # Share IPC namespace with the host (necessary for X11).
  - "--share=ipc"
  # Show windows using X11, if Wayland is not available.
  - "--socket=fallback-x11"
  # Show windows with Wayland.
  - "--socket=wayland"
